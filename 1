- name: Create a virtual machine on given ESXi hostname
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:
   - name: "This task creates the vm"
     vmware_guest:
      hostname: "192.168.1.144"
      username: "root"
      password: "Password1!"
      validate_certs: no
      folder: "/ha-datacenter/"
      name: test_vm_0001
      state: poweredon
      guest_id: rhel85
      validate_certs: false
#     delegate_to: localhost
      disk:
       - size_gb: 10
         type: thin
         datastore: 120GB_1
      hardware:
         memory_mb: 512
         num_cpus: 2
         scsi: paravirtual
      networks:
       - name: 'networks'
         mac: aa:bb:dd:aa:00:14
         ip: 192.168.1.152
         netmask: 255.255.255.0
         device_type: vmxnet3
         wait_for_ip_address: yes
